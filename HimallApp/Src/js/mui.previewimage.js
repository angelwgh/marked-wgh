(function(d,c){var i='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>';var j='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div>{{content}}</div>';var f="__DEFAULT";var b=document.createElement("div");var a=0;var g=function(k){this.options=d.extend(true,{id:"__MUI_PREVIEWIMAGE",zoom:true,header:'<span class="mui-preview-indicator"></span>',footer:""},k||{});this.init();this.initEvent()};var e=g.prototype;e.init=function(){var k=this.options;var l=document.getElementById(this.options.id);if(!l){b.innerHTML=i.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",k.header).replace("{{footer}}",k.footer);document.body.appendChild(b.firstElementChild);l=document.getElementById(this.options.id)}this.element=l;this.scroller=this.element.querySelector(d.classSelector(".slider-group"));this.indicator=this.element.querySelector(d.classSelector(".preview-indicator"));this.loader=this.element.querySelector(d.classSelector(".preview-loading"));if(k.footer){this.element.querySelector(d.classSelector(".preview-footer")).classList.remove(d.className("hidden"))}this.addImages()};e.initEvent=function(){var k=this;d(document.body).on("tap","img[data-preview-src]",function(){if(k.isAnimationing()){return false}k.open(this);return false});var l=null;var m=function(){!l&&(l=d.later(function(){k.isInAnimation=true;k.loader.removeEventListener("tap",m);k.scroller.removeEventListener("tap",m);k.close()},300))};this.scroller.addEventListener("doubletap",function(){if(l){l.cancel();l=null}});this.element.addEventListener("webkitAnimationEnd",function(){if(k.element.classList.contains(d.className("preview-out"))){k.element.style.display="none";k.element.classList.remove(d.className("preview-out"));l=null}else{k.loader.addEventListener("tap",m);k.scroller.addEventListener("tap",m)}k.isInAnimation=false});this.element.addEventListener("slide",function(o){if(k.options.zoom){var p=k.element.querySelector(".mui-zoom-wrapper:nth-child("+(k.lastIndex+1)+")");if(p){d(p).zoom().setZoom(1)}}var n=o.detail.slideNumber;k.lastIndex=n;k.indicator&&(k.indicator.innerText=(n+1)+"/"+k.currentGroup.length);k._loadItem(n)})};e.isAnimationing=function(){if(this.isInAnimation){return true}this.isInAnimation=true;return false};e.addImages=function(n,l){this.groups={};var o=[];if(n){if(n===f){o=document.querySelectorAll("img[data-preview-src]:not([data-preview-group])")}else{o=document.querySelectorAll("img[data-preview-src][data-preview-group='"+n+"']")}}else{o=document.querySelectorAll("img[data-preview-src]")}if(o.length){for(var m=0,k=o.length;m<k;m++){this.addImage(o[m])}}};e.addImage=function(k){var n=k.getAttribute("data-preview-group");n=n||f;if(!this.groups[n]){this.groups[n]=[]}var o=k.getAttribute("src");if(k.__mui_img_data&&k.__mui_img_data.src===o){this.groups[n].push(k.__mui_img_data)}else{var m=k.getAttribute("data-preview-src");if(!m){m=o}var l={src:o,lazyload:o===m?"":m,loaded:o===m?true:false,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:k};this.groups[n].push(l);k.__mui_img_data=l}};e.empty=function(){this.scroller.innerHTML=""};e._initImgData=function(k,m){if(!k.sWidth){var l=k.el;k.sWidth=l.offsetWidth;k.sHeight=l.offsetHeight;var n=d.offset(l);k.sTop=n.top;k.sLeft=n.left;k.sScale=Math.max(k.sWidth/c.innerWidth,k.sHeight/c.innerHeight)}m.style.webkitTransform="translate3d(0,0,0) scale("+k.sScale+")"};e._getScale=function(o,n){var k=o.width/n.width;var l=o.height/n.height;var m=1;if(k<=l){m=o.height/(n.height*k)}else{m=o.width/(n.width*l)}return m};e._imgTransitionEnd=function(l){var k=l.target;k.classList.remove(d.className("transitioning"));k.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))};e._loadItem=function(o,n){var m=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(o+1)+")"));var k=this.currentGroup[o];var q=m.querySelector("img");this._initImgData(k,q);if(n){var p=this._getPosition(k);q.style.webkitTransitionDuration="0ms";q.style.webkitTransform="translate3d("+p.x+"px,"+p.y+"px,0) scale("+k.sScale+")";q.offsetHeight}if(!k.loaded&&q.getAttribute("data-preview-lazyload")){var l=this;l.loader.classList.add(d.className("active"));q.style.webkitTransitionDuration="0.5s";q.addEventListener("webkitTransitionEnd",l._imgTransitionEnd.bind(l));q.style.webkitTransform="translate3d(0,0,0) scale("+k.sScale+")";this.loadImage(q,function(){k.loaded=true;q.src=k.lazyload;l._initZoom(m,this.width,this.height);q.classList.add(d.className("transitioning"));q.addEventListener("webkitTransitionEnd",l._imgTransitionEnd.bind(l));q.setAttribute("style","");q.offsetHeight;l.loader.classList.remove(d.className("active"))})}else{k.lazyload&&(q.src=k.lazyload);this._initZoom(m,q.width,q.height);q.classList.add(d.className("transitioning"));q.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this));q.setAttribute("style","");q.offsetHeight}this._preloadItem(o+1);this._preloadItem(o-1)};e._preloadItem=function(m){var l=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(m+1)+")"));if(l){var k=this.currentGroup[m];if(!k.sWidth){var n=l.querySelector("img");this._initImgData(k,n)}}};e._initZoom=function(n,p,o){if(!this.options.zoom){return}if(n.getAttribute("data-zoomer")){return}var m=n.querySelector(d.classSelector(".zoom"));if(m.tagName==="IMG"){var l=this;var k=l._getScale({width:n.offsetWidth,height:n.offsetHeight},{width:p,height:o});d(n).zoom({maxZoom:Math.max(k,1)})}else{d(n).zoom()}};e.loadImage=function(m,l){var n=function(){l&&l.call(this)};var k=new Image();k.onload=n;k.onerror=n;k.src=m.getAttribute("data-preview-lazyload")};e.getRangeByIndex=function(l,k){return{from:0,to:k-1}};e._getPosition=function(l){var m=l.sLeft-c.pageXOffset;var k=l.sTop-c.pageYOffset;var o=(c.innerWidth-l.sWidth)/2;var n=(c.innerHeight-l.sHeight)/2;return{left:m,top:k,x:m-o,y:k-n}};e.refresh=function(s,x){this.currentGroup=x;var r=x.length;var o=[];var q=this.getRangeByIndex(s,r);var w=q.from;var v=q.to+1;var t=s;var l="";var y="";var n=c.innerWidth;var u=c.innerHeight;for(var p=0;w<v;w++,p++){var m=x[w];var k="";if(m.sWidth){k="-webkit-transform:translate3d(0,0,0) scale("+m.sScale+");transform:translate3d(0,0,0) scale("+m.sScale+")"}y=j.replace("{{src}}",m.src).replace("{{lazyload}}",m.lazyload).replace("{{style}}",k);if(m.el.getAttribute("data-content")&&m.el.getAttribute("data-content")!=""){y=y.replace("{{content}}",'<div class="mui-slider-img-content">'+m.el.getAttribute("data-content")+"</div>")}else{y=y.replace("{{content}}","")}if(w===s){t=p;l=d.className("active")}else{l=""}o.push(y.replace("{{className}}",l))}this.scroller.innerHTML=o.join("");this.element.style.display="block";this.element.classList.add(d.className("preview-in"));this.lastIndex=t;this.element.offsetHeight;d(this.element).slider().gotoItem(t,0);this.indicator&&(this.indicator.innerText=(t+1)+"/"+this.currentGroup.length);this._loadItem(t,true)};e.openByGroup=function(k,l){k=Math.min(Math.max(0,k),this.groups[l].length-1);this.refresh(k,this.groups[l])};e.open=function(k,l){if(this.element.classList.contains(d.className("preview-in"))){return}if(typeof k==="number"){l=l||f;this.addImages(l,k);this.openByGroup(k,l)}else{l=k.getAttribute("data-preview-group");l=l||f;this.addImages(l,k);this.openByGroup(this.groups[l].indexOf(k.__mui_img_data),l)}};e.close=function(q,t){this.element.classList.remove(d.className("preview-in"));this.element.classList.add(d.className("preview-out"));var u=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")"));var k=u.querySelector("img");if(k){k.classList.add(d.className("transitioning"));var l=this.currentGroup[this.lastIndex];var m=this._getPosition(l);var r=m.left;var s=m.top;if(s>c.innerHeight||r>c.innerWidth||s<0||r<0){k.style.opacity=0;k.style.webkitTransitionDuration="0.5s";k.style.webkitTransform="scale("+l.sScale+")"}else{if(this.options.zoom){d(k.parentNode.parentNode).zoom().toggleZoom(0)}k.style.webkitTransitionDuration="0.5s";k.style.webkitTransform="translate3d("+m.x+"px,"+m.y+"px,0) scale("+l.sScale+")"}}var n=this.element.querySelectorAll(d.classSelector(".zoom-wrapper"));for(var o=0,p=n.length;o<p;o++){d(n[o]).zoom().destory()}};e.isShown=function(){return this.element.classList.contains(d.className("preview-in"))};var h=null;d.previewImage=function(k){if(!h){h=new g(k)}return h};d.getPreviewImage=function(){return h}})(mui,window);