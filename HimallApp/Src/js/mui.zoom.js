(function(d,a){var i=d.className("zoom");var h=d.className("zoom-scroller");var g="."+i;var f="."+h;var e="pinchstart";var c="pinch";var b="pinchend";if("ongesturestart" in a){e="gesturestart";c="gesturechange";b="gestureend"}d.Zoom=function(t,s){var l=this;l.options=d.extend(d.Zoom.defaults,s);l.wrapper=l.element=t;l.scroller=t.querySelector(f);l.scrollerStyle=l.scroller&&l.scroller.style;l.zoomer=t.querySelector(g);l.zoomerStyle=l.zoomer&&l.zoomer.style;l.init=function(){d.options.gestureConfig.pinch=true;d.options.gestureConfig.doubletap=true;l.initEvents()};l.initEvents=function(N){var L=N?"removeEventListener":"addEventListener";var M=l.scroller;M[L](e,l.onPinchstart);M[L](c,l.onPinch);M[L](b,l.onPinchend);M[L]("touchstart",l.onTouchstart);M[L]("touchmove",l.onTouchMove);M[L]("touchcancel",l.onTouchEnd);M[L]("touchend",l.onTouchEnd);M[L]("drag",function(O){if(I||q){O.stopPropagation()}});M[L]("doubletap",function(O){l.toggleZoom(O.detail.center)})};l.transition=function(L,M){M=M||0;L.webkitTransitionDuration=M+"ms";return l};l.translate=function(M,L,N){L=L||0;N=N||0;M.webkitTransform="translate3d("+L+"px,"+N+"px,0px)";return l};l.scale=function(L,M){M=M||1;L.webkitTransform="translate3d(0,0,0) scale("+M+")";return l};l.scrollerTransition=function(L){return l.transition(l.scrollerStyle,L)};l.scrollerTransform=function(L,M){return l.translate(l.scrollerStyle,L,M)};l.zoomerTransition=function(L){return l.transition(l.zoomerStyle,L)};l.zoomerTransform=function(L){return l.scale(l.zoomerStyle,L)};var K=1,z=1,u=false,q=false;l.onPinchstart=function(L){q=true};l.onPinch=function(L){if(!u){l.zoomerTransition(0);u=true}K=(L.detail?L.detail.scale:L.scale)*z;if(K>l.options.maxZoom){K=l.options.maxZoom-1+Math.pow((K-l.options.maxZoom+1),0.5)}if(K<l.options.minZoom){K=l.options.minZoom+1-Math.pow((l.options.minZoom-K+1),0.5)}l.zoomerTransform(K)};l.onPinchend=function(L){K=Math.max(Math.min(K,l.options.maxZoom),l.options.minZoom);l.zoomerTransition(l.options.speed).zoomerTransform(K);z=K;u=false};l.setZoom=function(L){K=z=L;l.scrollerTransition(l.options.speed).scrollerTransform(0,0);l.zoomerTransition(l.options.speed).zoomerTransform(K)};l.toggleZoom=function(L,N){if(typeof L==="number"){N=L;L=undefined}N=typeof N==="undefined"?l.options.speed:N;if(K&&K!==1){K=z=1;l.scrollerTransition(N).scrollerTransform(0,0)}else{K=z=l.options.maxZoom;if(L){var R=d.offset(l.zoomer);var Q=R.top;var P=R.left;var M=(L.x-P)*K;var O=(L.y-Q)*K;this._cal();if(M>=B&&M<=(B+o)){M=B-M+o/2}else{if(M<B){M=B-M+o/2}else{if(M>(B+o)){M=B+o-M-o/2}}}if(O>=D&&O<=(D+y)){O=D-O+y/2}else{if(O<D){O=D-O+y/2}else{if(O>(D+y)){O=D+y-O-y/2}}}M=Math.min(Math.max(M,A),B);O=Math.min(Math.max(O,C),D);l.scrollerTransition(N).scrollerTransform(M,O)}else{l.scrollerTransition(N).scrollerTransform(0,0)}}l.zoomerTransition(N).zoomerTransform(K)};l._cal=function(){o=l.wrapper.offsetWidth;y=l.wrapper.offsetHeight;p=l.zoomer.offsetWidth;F=l.zoomer.offsetHeight;var L=p*K;var M=F*K;A=Math.min((o/2-L/2),0);B=-A;C=Math.min((y/2-M/2),0);D=-C};var o,y,E,I,n,k,A,C,B,D,p,F,x={},r={},H,J,v,G,m,w,j;l.onTouchstart=function(L){L.preventDefault();E=true;x.x=L.type==="touchstart"?L.targetTouches[0].pageX:L.pageX;x.y=L.type==="touchstart"?L.targetTouches[0].pageY:L.pageY};l.onTouchMove=function(N){N.preventDefault();if(!E){return}if(!I){o=l.wrapper.offsetWidth;y=l.wrapper.offsetHeight;p=l.zoomer.offsetWidth;F=l.zoomer.offsetHeight;var O=d.parseTranslateMatrix(d.getStyles(l.scroller,"webkitTransform"));H=O.x||0;J=O.y||0;l.scrollerTransition(0)}var L=p*K;var M=F*K;if(L<o&&M<y){return}A=Math.min((o/2-L/2),0);B=-A;C=Math.min((y/2-M/2),0);D=-C;r.x=N.type==="touchmove"?N.targetTouches[0].pageX:N.pageX;r.y=N.type==="touchmove"?N.targetTouches[0].pageY:N.pageY;if(!I&&!u){if((Math.floor(A)===Math.floor(H)&&r.x<x.x)||(Math.floor(B)===Math.floor(H)&&r.x>x.x)){E=false;return}}I=true;n=r.x-x.x+H;k=r.y-x.y+J;if(n<A){n=A+1-Math.pow((A-n+1),0.8)}if(n>B){n=B-1+Math.pow((n-B+1),0.8)}if(k<C){k=C+1-Math.pow((C-k+1),0.8)}if(k>D){k=D-1+Math.pow((k-D+1),0.8)}if(!v){v=r.x}if(!w){w=r.y}if(!G){G=d.now()}m=(r.x-v)/(d.now()-G)/2;j=(r.y-w)/(d.now()-G)/2;if(Math.abs(r.x-v)<2){m=0}if(Math.abs(r.y-w)<2){j=0}v=r.x;w=r.y;G=d.now();l.scrollerTransform(n,k)};l.onTouchEnd=function(U){if(!U.touches.length){q=false}if(!E||!I){E=false;I=false;return}E=false;I=false;var L=300;var M=300;var O=m*L;var S=n+O;var N=j*M;var Q=k+N;if(m!==0){L=Math.abs((S-n)/m)}if(j!==0){M=Math.abs((Q-k)/j)}var R=Math.max(L,M);n=S;k=Q;var P=p*K;var T=F*K;A=Math.min((o/2-P/2),0);B=-A;C=Math.min((y/2-T/2),0);D=-C;n=Math.max(Math.min(n,B),A);k=Math.max(Math.min(k,D),C);l.scrollerTransition(R).scrollerTransform(n,k)};l.destory=function(){l.initEvents(true);delete d.data[l.wrapper.getAttribute("data-zoomer")];l.wrapper.setAttribute("data-zoomer","")};l.init();return l};d.Zoom.defaults={speed:300,maxZoom:3,minZoom:1,};d.fn.zoom=function(k){var j=[];this.each(function(){var m=null;var l=this;var n=l.getAttribute("data-zoomer");if(!n){n=++d.uuid;d.data[n]=m=new d.Zoom(l,k);l.setAttribute("data-zoomer",n)}else{m=d.data[n]}j.push(m)});return j.length===1?j[0]:j}})(mui,window);